{"version":3,"sources":["app.js","environment.js","main.js","lib/custom-audio-recorder.js","lib/word-utils.js","resources/index.js","containers/main-page/main-page.js","gateways/data/data-api.js","resources/elements/audio-recorder.js","resources/elements/file-dropper.js","containers/main-page/main-page.scss","resources/elements/file-dropper.scss"],"names":["App","configureRouter","cfg","router","title","map","route","name","moduleId","debug","testing","gatewayRootURL","configure","Promise","config","warnings","wForgottenReturn","aurelia","use","standardConfiguration","feature","developmentLogging","plugin","start","then","setRoot","AudioRecorder","recordingStopSuccessCallback","recordingStopErrorCallback","permission","outputType","shouldLoop","playing","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","requestPermission","constraints","audio","chunks","onSuccess","stream","mediaRecorder","MediaRecorder","mediaStream","onstop","e","clipContainer","document","createElement","classList","add","setAttribute","appendChild","controls","blob","Blob","audioURL","window","URL","createObjectURL","src","ondataavailable","push","data","onError","err","startRecording","stopRecording","stop","play","pause","currentTime","loop","bool","stepBackward","stepForward","duration","clear","setOutputFileType","fileType","hasPermission","undefined","isLooping","isPlaying","isFinished","getRecording","getRecordingFile","getStream","getOutputType","ended","normalizeWord","word","trim","toLowerCase","globalResources","MainPage","api","normalizedQuery","handleSavePronunciation","bind","handlePronunciationFileValidation","activate","initDataModel","attached","audioPlayer","Audio","uploadingForWordId","recordingForWordId","isUploadingRecording","pronunciationLoadMap","pronunciationCache","queryStoredInBackend","isLoadingWords","wordsLoadedPct","queryChanged","query","queryResult","loaded","doneLoading","words","setTimeout","find","getWordsRequest","withDownloadProgressCallback","total","parseInt","send","response","content","catch","playPronunciation","wordId","lastModified","prevPronunciation","hasNotChanged","getWordRequest","playAudioBlob","audioBlob","loadMap","isAudioLoading","audioLoadedPct","getPronunciationRequest","withResponseType","handleRecordPronunciationClick","handleUploadPronunciationClick","getWordPronunciationUpdateRequest","console","warn","handleSavePronunciationFile","file","log","errors","type","size","DataAPI","client","withBaseUrl","prefix","createRequest","asGet","formData","FormData","append","asPut","withContent","getWordCreationRequest","onRecorderSuccess","isAttached","isRecording","isProcessingRecording","resetDataModel","recorder","timeLeft","durationSeconds","killTimeMillis","Date","getTime","countdownInterval","setInterval","currTimeMillis","currTimeLeft","Math","round","clearInterval","playRecording","detached","handleSaveClicked","save","FileDropper","Element","element","initializeDataModel","initializeDOMHooks","wireEventListeners","stagedFileErrors","$element","$","$dropzone","$fileInput","isAdvancedUpload","div","on","fileList","target","files","handleNewFileList","click","stopPropagation","addClass","preventDefault","removeClass","originalEvent","dataTransfer","unwireListeners","off","length","stagedFile","validateStagedFile","val","handleClearClicked","saveFile","getByteSizes","bytes","kiloBytes","megaBytes","getFileSizeString","byteSizes"],"mappings":"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","file":"app-bundle.js","sourcesContent":["export class App {\r\n  constructor() {}\r\n\r\n  configureRouter(cfg, router) {\r\n    this.router = router;\r\n    cfg.title = 'Word.ly';\r\n\r\n    cfg.map([\r\n      {\r\n        route: '',\r\n        name: 'main',\r\n        moduleId: 'containers/main-page/main-page'\r\n      }\r\n    ]);\r\n  }\r\n}\r\n","export default {\r\n  debug: true,\r\n  testing: true,\r\n  gatewayRootURL: 'http://localhost:8080'\r\n};\r\n","import environment from './environment';\r\n\r\n//Configure Bluebird Promises.\r\nPromise.config({\r\n  warnings: {\r\n    wForgottenReturn: false\r\n  }\r\n});\r\n\r\nexport function configure(aurelia) {\r\n  aurelia.use\r\n    .standardConfiguration()\r\n    .feature('resources');\r\n\r\n  if (environment.debug) {\r\n    aurelia.use.developmentLogging();\r\n  }\r\n\r\n  if (environment.testing) {\r\n    aurelia.use.plugin('aurelia-testing');\r\n  }\r\n\r\n  aurelia.start().then(() => aurelia.setRoot());\r\n}\r\n","/* ADAPTED FROM https://github.com/Authman2/AUAudioRecorder */\r\n\r\nexport default class AudioRecorder {\r\n  permission = false;\r\n  mediaRecorder;\r\n  outputType = 'audio/mp3; codecs=opus'; // Default is mp3\r\n  audio; // This 'audio' serves as the final recording by the user.\r\n  blob; // The blob that can be used for file operations.\r\n  mediaStream;\r\n  shouldLoop = false;\r\n  playing = false;\r\n\r\n  recordingStopSuccessCallback;\r\n  recordingStopErrorCallback;\r\n\r\n  constructor(recordingStopSuccessCallback, recordingStopErrorCallback) {\r\n    navigator.getUserMedia = (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia);\r\n    this.recordingStopSuccessCallback = recordingStopSuccessCallback;\r\n    this.recordingStopErrorCallback = recordingStopErrorCallback;\r\n  }\r\n  /* Asks the user for their this.permission to access the computer's microphone. */\r\n\r\n  requestPermission() {\r\n    if (navigator.getUserMedia) {\r\n      // Definitions\r\n      const constraints = { audio: true };\r\n      let chunks = [];\r\n\r\n      const onSuccess = (stream) => {\r\n        // Initialize the media recorder\r\n        this.mediaRecorder = new MediaRecorder(stream);\r\n        this.mediaStream = stream;\r\n\r\n        this.mediaRecorder.onstop = (e) => {\r\n          // Create some new elements in the html\r\n          const clipContainer = document.createElement('article');\r\n          clipContainer.classList.add('clip');\r\n          this.audio = document.createElement('audio');\r\n          this.audio.setAttribute('controls', '');\r\n          clipContainer.appendChild(this.audio);\r\n\r\n          // Set some properties\r\n          this.audio.controls = true;\r\n          const blob = new Blob(chunks, { 'type': this.outputType });\r\n          chunks = [];\r\n          const audioURL = window.URL.createObjectURL(blob);\r\n          this.audio.src = audioURL;\r\n          this.blob = blob;\r\n\r\n          if (typeof this.recordingStopSuccessCallback === 'function') {\r\n            this.recordingStopSuccessCallback(blob);\r\n          }\r\n        };// End of onstop action.\r\n\r\n        this.mediaRecorder.ondataavailable = (e) => {\r\n          chunks.push(e.data);\r\n        }; // End of ondataavailable action.\r\n      }; // End of onSuccess\r\n\r\n      const onError = (err) => {\r\n        if (typeof this.recordingStopErrorCallback === 'function') {\r\n          this.recordingStopErrorCallback(err);\r\n        }\r\n      };// End of onError\r\n\r\n      this.permission = true;\r\n      navigator.getUserMedia(constraints, onSuccess, onError);\r\n    } // End of if-supported-statement.\r\n  }\r\n\r\n  /* Starts the recording. */\r\n  startRecording() {\r\n    if (this.mediaRecorder !== null) {\r\n      this.mediaRecorder.start();\r\n    }\r\n  }\r\n\r\n  /* Stops the recording. */\r\n  stopRecording() {\r\n    if (this.mediaRecorder !== null) {\r\n      this.mediaRecorder.stop();\r\n    }\r\n  }\r\n\r\n  /* Plays the recording. */\r\n  play() {\r\n    if (this.audio !== null) {\r\n      this.audio.play();\r\n      this.playing = true;\r\n    }\r\n  }\r\n  /* Pauses the recording. */\r\n  pause() {\r\n    if (this.audio !== null) {\r\n      this.audio.pause();\r\n      this.playing = false;\r\n    }\r\n  }\r\n\r\n  /* Stops the recording from this.playing. Calling 'play' will start it from the beginning. */\r\n  stop() {\r\n    if (this.audio !== null) {\r\n      this.audio.pause();\r\n      this.audio.currentTime = 0;\r\n      this.playing = false;\r\n    }\r\n  }\r\n\r\n  /* Loops the recorded this.audio. */\r\n  loop(bool) {\r\n    if (this.audio !== null) {\r\n      (bool === true) ? this.audio.loop = true : this.audio.loop = false;\r\n    }\r\n  }\r\n\r\n  /* Goes to the beginning of the this.audio. */\r\n  stepBackward() {\r\n    if (this.audio !== null) {\r\n      this.audio.currentTime = 0;\r\n    }\r\n  }\r\n\r\n  /* Goes to the end of the this.audio. */\r\n  stepForward() {\r\n    if (this.audio !== null) {\r\n      this.audio.currentTime = this.audio.duration;\r\n    }\r\n  }\r\n\r\n  /* Clears the current recording. */\r\n  clear() {\r\n    this.audio = null;\r\n    this.playing = false;\r\n  }\r\n\r\n  /* Sets the file type for the this.audio recording.\r\n  Ex.) mp3, wav, ogg, etc.... */\r\n  setOutputFileType(fileType) {\r\n    this.outputType = 'audio/' + fileType + '; codecs=opus';\r\n  }\r\n\r\n  /* Returns whether or not the program has the user's this.permission to use the microphone. */\r\n  hasPermission() {\r\n    if (this.permission === undefined) return false;\r\n    return (this.permission === true) ? true : false;\r\n  }\r\n\r\n  /* Returns whether or not the this.audio will loop. */\r\n  isLooping() {\r\n    if (this.audio !== null && (typeof (this.audio) !== null) && this.audio !== undefined) {\r\n      if (this.audio.loop === true) {\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /* Returns whether or not the this.audio is currently this.playing. */\r\n  isPlaying() {\r\n    if (this.audio !== null && (typeof (this.audio) !== null) && this.audio !== undefined) {\r\n      if ((this.audio.currentTime === this.audio.duration && this.audio.loop === false) || (this.audio.currentTime === 0) || (this.isFinished())) {\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /* Returns the this.audio object that contains the final recording. */\r\n  getRecording() {\r\n    if (this.audio !== null && (typeof (this.audio) !== null) && this.audio !== undefined) { return this.audio; }\r\n    return null;\r\n  }\r\n\r\n  /* Returns a Blob object, which can be used for file operations. */\r\n  getRecordingFile() {\r\n    return this.blob;\r\n  }\r\n\r\n  /* This returns the media stream from the web audio API. */\r\n  getStream() {\r\n    if (this.mediaStream !== null && (typeof (this.mediaStream) !== null) && this.mediaStream !== undefined) { return this.mediaStream; }\r\n    return null;\r\n  }\r\n\r\n  /* Returns the output file type. */\r\n  getOutputType() {\r\n    if (this.outputType !== null && (typeof (this.outputType) !== null) && this.outputType !== undefined) { return this.outputType; }\r\n    return null;\r\n  }\r\n\r\n  /* Returns whether or not the audio is finished playing. */\r\n  isFinished() {\r\n    if (this.audio !== null && (typeof (this.audio) !== null) && this.audio !== undefined) { return this.audio.ended; }\r\n    return null;\r\n  }\r\n}\r\n\r\n","export const normalizeWord = (word) => (\r\n  word ? word.trim().toLowerCase() : word\r\n);\r\n","export function configure(config) {\r\n  config.globalResources([\r\n    './elements/audio-recorder',\r\n    './elements/file-dropper'\r\n  ]);\r\n}\r\n","import { inject } from 'aurelia-framework';\r\nimport { bindable } from 'aurelia-framework';\r\n\r\nimport { normalizeWord } from '../../lib/word-utils';\r\nimport { DataAPI } from '../../gateways/data/data-api';\r\n\r\n@inject(DataAPI)\r\nexport class MainPage {\r\n  @bindable query = '';\r\n  normalizedQuery = '';\r\n\r\n  constructor(api) {\r\n    this.api = api;\r\n    this.handleSavePronunciation = this.handleSavePronunciation.bind(this);\r\n    this.handlePronunciationFileValidation = this.handlePronunciationFileValidation.bind(this);\r\n  }\r\n\r\n  activate() {\r\n    this.initDataModel();\r\n  }\r\n\r\n  attached() {\r\n    this.audioPlayer = new window.Audio();\r\n  }\r\n\r\n  initDataModel() {\r\n    this.uploadingForWordId = null;\r\n    this.recordingForWordId = null;\r\n    this.isUploadingRecording = false;\r\n\r\n    this.pronunciationLoadMap = {};\r\n    this.pronunciationCache = {};\r\n    this.queryStoredInBackend = true;\r\n\r\n    this.isLoadingWords = false;\r\n    this.wordsLoadedPct = 0;\r\n  }\r\n\r\n  queryChanged() {\r\n    const normalizedQuery = this.normalizedQuery = normalizeWord(this.query);\r\n    this.queryResult = [];\r\n    this.queryStoredInBackend = true;\r\n    if (normalizedQuery) {\r\n      this.isLoadingWords = true;\r\n      this.loaded = 0;\r\n\r\n      const doneLoading = (words) => {\r\n        this.wordsLoadedPct = 100;\r\n        setTimeout(() => {\r\n          this.isLoadingWords = false;\r\n          this.queryStoredInBackend = typeof words.find(word => word.word === normalizedQuery) !== 'undefined';\r\n          this.queryResult = words;\r\n        }, 150);\r\n      };\r\n\r\n      this.api.getWordsRequest(normalizedQuery)\r\n        .withDownloadProgressCallback(({ loaded, total }) => this.wordsLoadedPct = parseInt(loaded * 100.0 / total, 10))\r\n        .send()\r\n        .then((response) => {\r\n          const words = response.content;\r\n          doneLoading(words);\r\n        })\r\n        .catch((err) => {\r\n          doneLoading();\r\n        });\r\n    }\r\n  }\r\n\r\n  playPronunciation(wordId) {\r\n    // check cache\r\n    let lastModified;\r\n    if (this.pronunciationCache[wordId]) {\r\n      const prevPronunciation = this.pronunciationCache[wordId];\r\n      let hasNotChanged = true;\r\n      this.api.getWordRequest(wordId)\r\n        .send()\r\n        .then((response) => {\r\n          const word = response.content;\r\n          lastModified = word.lastModified;\r\n          hasNotChanged = prevPronunciation.lastModified === lastModified;\r\n        });\r\n\r\n      if (hasNotChanged) {\r\n        this.playAudioBlob(prevPronunciation.audioBlob);\r\n        return;\r\n      }\r\n    }\r\n\r\n    // download audio\r\n    const loadMap = this.pronunciationLoadMap[wordId] = {\r\n      isAudioLoading: true,\r\n      audioLoadedPct: 0\r\n    };\r\n    const doneLoading = (audioBlob) => {\r\n      loadMap.audioLoadedPct = 100;\r\n      setTimeout(() => {\r\n        loadMap.isAudioLoading = false;\r\n        if (audioBlob) {\r\n          this.playAudioBlob(audioBlob);\r\n        }\r\n      }, 150);\r\n    };\r\n\r\n    this.api.getPronunciationRequest(wordId)\r\n      .withResponseType('blob')\r\n      .withDownloadProgressCallback(({ loaded, total }) => loadMap.audioLoadedPct = parseInt(loaded * 100.0 / total, 10))\r\n      .send()\r\n      .then((response) => {\r\n        const audioBlob = response.content;\r\n        this.pronunciationCache[wordId] = { audioBlob, lastModified };\r\n        doneLoading(audioBlob);\r\n      })\r\n      .catch((err) => {\r\n        doneLoading();\r\n      });\r\n  }\r\n\r\n  handleRecordPronunciationClick(wordId) {\r\n    this.uploadingForWordId = null;\r\n    if (this.recordingForWordId === wordId) {\r\n      this.recordingForWordId = null;\r\n      return;\r\n    }\r\n    this.recordingForWordId = wordId;\r\n  }\r\n\r\n  handleUploadPronunciationClick(wordId) {\r\n    this.recordingForWordId = null;\r\n    if (this.uploadingForWordId === wordId) {\r\n      this.uploadingForWordId = null;\r\n      return;\r\n    }\r\n    this.uploadingForWordId = wordId;\r\n  }\r\n\r\n  handleSavePronunciation(audioBlob) {\r\n    this.isUploadingRecording = true;\r\n    this.api.getWordPronunciationUpdateRequest(this.recordingForWordId, audioBlob)\r\n      .send()\r\n      .then(() => {\r\n        this.isUploadingRecording = false;\r\n        this.recordingForWordId = null;\r\n      })\r\n      .catch((err) => {\r\n        console.warn(err);\r\n        this.isUploadingRecording = false;\r\n      });\r\n  }\r\n\r\n  handleSavePronunciationFile(file) {\r\n    console.log(file);\r\n  }\r\n\r\n  handlePronunciationFileValidation(file) {\r\n    const errors = [];\r\n    if (file.type !== 'audio/mp3') {\r\n      errors.push('We only accept .mp3 files');\r\n    }\r\n\r\n    if (file.size >= 1000) {\r\n      errors.push('The size of the file exceeds the maximum limitation of 1MB');\r\n    }\r\n\r\n    return errors;\r\n  }\r\n\r\n  playAudioBlob(audioBlob) {\r\n    this.audioPlayer.src = window.URL.createObjectURL(audioBlob);\r\n    this.audioPlayer.play();\r\n  }\r\n}\r\n","import { inject } from 'aurelia-framework';\r\nimport { HttpClient } from 'aurelia-http-client';\r\nimport environment from '../../environment';\r\n\r\n@inject(HttpClient)\r\nexport class DataAPI {\r\n  constructor(client) {\r\n    this.client = client.configure(cfg => cfg\r\n      .withBaseUrl(environment.gatewayRootURL)\r\n    );\r\n  }\r\n\r\n  getWordsRequest(prefix) {\r\n    return this.client\r\n      .createRequest(`/words?query=${prefix}`)\r\n      .asGet();\r\n  }\r\n\r\n  getPronunciationRequest(wordId) {\r\n    return this.client\r\n      .createRequest(`/words/${wordId}/pronunciation`)\r\n      .asGet();\r\n  }\r\n\r\n  getWordRequest(wordId) {\r\n    return this.client\r\n      .createRequest(`/words/${wordId}`)\r\n      .asGet();\r\n  }\r\n\r\n  getWordPronunciationUpdateRequest(wordId, audioBlob) {\r\n    const formData = new FormData();\r\n    formData.append('pronunciation', audioBlob);\r\n    return this.client\r\n      .createRequest(`/words/${wordId}/pronunciation`)\r\n      .asPut()\r\n      .withContent(formData);\r\n  }\r\n\r\n  getWordCreationRequest(word, audioBlob) {\r\n    return this.client\r\n      .createRequest('/words')\r\n      .asPut();\r\n  }\r\n}\r\n","import { bindable } from 'aurelia-framework';\r\n\r\nimport CustomAudioRecorder from '../../lib/custom-audio-recorder';\r\n\r\nexport class AudioRecorder {\r\n  @bindable save;\r\n  @bindable isSaving = false;\r\n  @bindable durationSeconds = 10;\r\n\r\n  constructor() {\r\n    this.initDataModel();\r\n    this.onRecorderSuccess = this.onRecorderSuccess.bind(this);\r\n  }\r\n\r\n  initDataModel() {\r\n    this.isAttached = false;\r\n    this.isRecording = false;\r\n    this.isProcessingRecording = false;\r\n    this.audioBlob = null;\r\n  }\r\n\r\n  resetDataModel() {\r\n    this.initDataModel();\r\n  }\r\n\r\n  attached() {\r\n    const recorder = this.recorder = new CustomAudioRecorder(this.onRecorderSuccess);\r\n    this.isAttached = true;\r\n    if (!recorder.hasPermission()) {\r\n      recorder.requestPermission();\r\n    }\r\n  }\r\n\r\n  onRecorderSuccess(audioBlob) {\r\n    this.audioBlob = audioBlob;\r\n    this.isProcessingRecording = false;\r\n  }\r\n\r\n  get hasPermission() {\r\n    return this.recorder && this.recorder.hasPermission();\r\n  }\r\n\r\n  get hasAudioData() {\r\n    return this.audioBlob;\r\n  }\r\n\r\n  get isPlaying() {\r\n    return this.recorder.isPlaying();\r\n  }\r\n\r\n  startRecording() {\r\n    this.audioBlob = null;\r\n    this.isRecording = true;\r\n    this.timeLeft = parseInt(this.durationSeconds, 10);\r\n    const killTimeMillis = new Date().getTime() + this.timeLeft * 1000;\r\n    this.countdownInterval = setInterval(() => {\r\n      const currTimeMillis = new Date().getTime();\r\n      const currTimeLeft = parseInt(Math.round((killTimeMillis - currTimeMillis) / 1000.0, 0), 10);\r\n      this.timeLeft = currTimeLeft >= 0 ? currTimeLeft : 0;\r\n      if (currTimeMillis >= killTimeMillis) {\r\n        this.stopRecording();\r\n      }\r\n    }, 1000);\r\n    this.recorder.startRecording();\r\n  }\r\n\r\n  stopRecording() {\r\n    this.isRecording = false;\r\n    this.isProcessingRecording = true;\r\n    this.recorder.stopRecording();\r\n    if (this.countdownInterval) {\r\n      clearInterval(this.countdownInterval);\r\n    }\r\n  }\r\n\r\n  playRecording() {\r\n    this.recorder.play();\r\n  }\r\n\r\n  detached() {\r\n    this.resetDataModel();\r\n    if (this.countdownInterval) {\r\n      clearInterval(this.countdownInterval);\r\n    }\r\n  }\r\n\r\n  handleSaveClicked() {\r\n    if (typeof this.save === 'function') {\r\n      this.save(this.audioBlob);\r\n    } else {\r\n      console.warn('No save callback provided');\r\n    }\r\n  }\r\n}\r\n","import { inject, bindable } from 'aurelia-framework';\r\n\r\nimport 'jquery';\r\n\r\n// adapted from https://css-tricks.com/drag-and-drop-file-uploading/\r\n@inject(Element)\r\nexport class FileDropper {\r\n  @bindable isSaving = false;\r\n  @bindable saveFile;\r\n  @bindable validateStagedFile;\r\n\r\n  stagedFile;\r\n\r\n  constructor(element) {\r\n    this.element = element;\r\n  }\r\n\r\n  attached() {\r\n    this.initializeDataModel();\r\n    this.initializeDOMHooks();\r\n    this.wireEventListeners();\r\n  }\r\n\r\n  initializeDataModel() {\r\n    this.stagedFileErrors = [];\r\n  }\r\n\r\n  initializeDOMHooks() {\r\n    this.$element = $(this.element);\r\n    this.$dropzone = this.$element.find('.dropzone');\r\n    this.$fileInput = this.$dropzone.find('input[type=\"file\"]');\r\n  }\r\n\r\n  wireEventListeners() {\r\n    const $fileInput = this.$fileInput;\r\n    const $dropzone = this.$dropzone;\r\n\r\n    const isAdvancedUpload = (() => {\r\n      const div = document.createElement('div');\r\n      return (('draggable' in div) || ('ondragstart' in div && 'ondrop' in div)) && 'FormData' in window && 'FileReader' in window;\r\n    })();\r\n\r\n    $fileInput.on('change', (e) => {\r\n      const fileList = e.target.files;\r\n      this.handleNewFileList(fileList);\r\n    });\r\n\r\n    $dropzone.on('click', (e) => {\r\n      $fileInput.click();\r\n    });\r\n\r\n    $fileInput.on('click', (e) => {\r\n      e.stopPropagation();\r\n    });\r\n\r\n    if (isAdvancedUpload) {\r\n      $dropzone.addClass('has-advanced-upload')\r\n        .on('drag dragstart dragend dragover dragenter dragleave drop', (e) => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        })\r\n        .on('dragover dragenter', () => {\r\n          $dropzone.addClass('is-dragover');\r\n        })\r\n        .on('dragleave dragend drop', () => {\r\n          $dropzone.removeClass('is-dragover');\r\n        })\r\n        .on('drop', (e) => {\r\n          const fileList = e.originalEvent.dataTransfer.files;\r\n          this.handleNewFileList(fileList);\r\n        });\r\n    }\r\n  }\r\n\r\n  unwireListeners() {\r\n    this.$dropzone.off();\r\n    this.$fileInput.off();\r\n  }\r\n\r\n  handleNewFileList(fileList) {\r\n    if (fileList.length) {\r\n      const stagedFile = this.stagedFile = fileList[0];\r\n      if (typeof this.validateStagedFile === 'function') {\r\n        this.stagedFileErrors = this.validateStagedFile(stagedFile);\r\n      } else {\r\n        this.stagedFileErrors = [];\r\n      }\r\n    } else {\r\n      this.stagedFile = null;\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.stagedFile = null;\r\n    this.$fileInput.val('');\r\n    this.stagedFileErrors = [];\r\n  }\r\n\r\n  handleClearClicked() {\r\n    this.clear();\r\n  }\r\n\r\n  handleSaveClicked() {\r\n    if (typeof this.saveFile === 'function') {\r\n      this.saveFile(this.stagedFile);\r\n    } else {\r\n      console.warn('No save callback provided');\r\n    }\r\n  }\r\n\r\n  get hasStagedFile() {\r\n    return this.stagedFile;\r\n  }\r\n\r\n  get isStagedFileValid() {\r\n    return this.stagedFile && !this.stagedFileErrors.length;\r\n  }\r\n\r\n  detached() {\r\n    this.clear();\r\n    this.unwireListeners();\r\n  }\r\n\r\n  getByteSizes(bytes) {\r\n    return {\r\n      kiloBytes: parseInt(Math.round(bytes / 1000.0, 0), 10),\r\n      megaBytes: parseInt(Math.round(bytes / 1000000.0, 0), 10)\r\n    };\r\n  }\r\n\r\n  getFileSizeString(file) {\r\n    const byteSizes = this.getByteSizes(file.size);\r\n    if (byteSizes.megaBytes) {\r\n      return `~${byteSizes.megaBytes} MB`;\r\n    }\r\n\r\n    return `~${byteSizes.kiloBytes} MB`;\r\n  }\r\n}\r\n",".progress {\r\n  margin-bottom: 0 !important;\r\n}\r\n\r\n.word-controls-group.not-loading {\r\n  margin-bottom: 6px;\r\n}\r\n",".dropzone {\r\n  font-size: 1.25rem;\r\n  background-color: #f1f0f0;\r\n  position: relative;\r\n  padding-top: 25px;\r\n  padding-bottom: 25px;\r\n  cursor: pointer;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.dropzone.has-advanced-upload {\r\n  outline: 2px dashed #92b0b3;\r\n  outline-offset: -10px;\r\n\r\n  -webkit-transition: outline-offset .15s ease-in-out, background-color .15s linear;\r\n  transition: outline-offset .15s ease-in-out, background-color .15s linear;\r\n}\r\n\r\n.dropzone.is-dragover {\r\n  outline-offset: -20px;\r\n  outline-color: #f1f0f0;\r\n  background-color: #fff;\r\n}\r\n\r\n.dropzone_dragdrop,\r\n.dropzone_icon {\r\n  display: none;\r\n}\r\n\r\n.dropzone.has-advanced-upload .dropzone_dragdrop {\r\n  display: inline;\r\n}\r\n\r\n.dropzone.has-advanced-upload .dropzone_icon {\r\n  width: 100%;\r\n  height: 80px;\r\n  fill: #92b0b3;\r\n  display: block;\r\n  margin-bottom: 40px;\r\n}\r\n\r\n.dropzone_input_ctr {\r\n  width: 250px;\r\n  margin: 0 auto;\r\n}\r\n\r\n@-webkit-keyframes appear-from-inside {\r\n  from\t{ -webkit-transform: translateY( -50% ) scale( 0 ); }\r\n  75%\t\t{ -webkit-transform: translateY( -50% ) scale( 1.1 ); }\r\n  to\t\t{ -webkit-transform: translateY( -50% ) scale( 1 ); }\r\n}\r\n\r\n@keyframes appear-from-inside {\r\n  from\t{ transform: translateY( -50% ) scale( 0 ); }\r\n  75%\t\t{ transform: translateY( -50% ) scale( 1.1 ); }\r\n  to\t\t{ transform: translateY( -50% ) scale( 1 ); }\r\n}\r\n\r\n.staged-file-display {\r\n  margin-top: 15px;\r\n}\r\n\r\n.btn-file {\r\n    position: relative;\r\n    overflow: hidden;\r\n}\r\n\r\n.btn-file input[type=file] {\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n    min-width: 100%;\r\n    min-height: 100%;\r\n    font-size: 100px;\r\n    text-align: right;\r\n    filter: alpha(opacity=0);\r\n    opacity: 0;\r\n    outline: none;\r\n    background: white;\r\n    cursor: inherit;\r\n    display: block;\r\n}"],"sourceRoot":"../src"}