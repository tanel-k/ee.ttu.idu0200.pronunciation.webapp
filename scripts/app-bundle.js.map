{"version":3,"sources":["app.js","environment.js","main.js","lib/custom-audio-recorder.js","lib/word-utils.js","resources/index.js","containers/main-page/main-page.js","gateways/data/data-api.js","resources/attributes/allowed-chars.js","resources/elements/audio-recorder.js","resources/elements/file-dropper.js","containers/main-page/main-page.scss","resources/elements/file-dropper.scss"],"names":["App","configureRouter","cfg","router","title","map","route","name","moduleId","debug","testing","gatewayRootURL","configure","Promise","config","warnings","wForgottenReturn","aurelia","use","standardConfiguration","feature","developmentLogging","plugin","start","then","setRoot","AudioRecorder","recordingStopSuccessCallback","recordingStopErrorCallback","permission","outputType","shouldLoop","playing","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","requestPermission","constraints","audio","chunks","onSuccess","stream","mediaRecorder","MediaRecorder","mediaStream","onstop","e","clipContainer","document","createElement","classList","add","setAttribute","appendChild","controls","blob","Blob","audioURL","window","URL","createObjectURL","src","ondataavailable","push","data","onError","err","startRecording","stopRecording","stop","play","pause","currentTime","loop","bool","stepBackward","stepForward","duration","clear","setOutputFileType","fileType","hasPermission","undefined","isLooping","isPlaying","isFinished","getRecording","getRecordingFile","getStream","getOutputType","ended","normalizeWord","word","trim","toLowerCase","globalResources","Toastr","MainPage","Element","element","api","normalizedQuery","handleSavePronunciation","bind","handlePronunciationFileValidation","handleSavePronunciationFile","handleSaveNewWord","activate","initDataModel","attached","audioPlayer","Audio","initDOMHooks","wireEventListeners","uploadingForWordId","recordingForWordId","isUploadingRecording","isCreatingWord","isUploadingNewWord","isRecordingNewWord","pronunciationLoadMap","pronunciationCache","queryStoredInBackend","isLoadingWords","wordsLoadedPct","wordFinderInput","querySelector","wordFinderErrorLabel","lastMessageTimeout","lastClearTimeout","addEventListener","remove","clearTimeout","innerText","setTimeout","queryChanged","queryWords","query","queryResult","loaded","doneLoading","words","find","getWordsRequest","withDownloadProgressCallback","total","parseInt","send","response","content","catch","playPronunciation","wordId","downloadAudio","lastModified","loadMap","isAudioLoading","audioLoadedPct","audioBlob","playAudioBlob","getPronunciationRequest","withResponseType","prevPronunciation","hasNotChanged","getWordRequest","handleRecordPronunciationClick","handleUploadPronunciationClick","getWordPronunciationUpdateRequest","notifySuccess","notifyFailure","file","getWordCreationRequest","setNotRegisteringWord","setRegisteringWord","handleRegisterWordClick","handleRegisterWordCancelClick","handleNewWordRecordClick","handleNewWordUploadClick","errors","type","size","message","info","timeOut","warning","DataAPI","client","withBaseUrl","prefix","createRequest","asGet","formData","FormData","append","asPut","withContent","AllowedChars","enterPressed","key","value","includes","preventDefault","dispatchEvent","Event","detached","removeEventListener","onRecorderSuccess","isAttached","isRecording","isProcessingRecording","resetDataModel","recorder","timeLeft","durationSeconds","killTimeMillis","Date","getTime","countdownInterval","setInterval","currTimeMillis","currTimeLeft","Math","round","clearInterval","playRecording","handleSaveClicked","save","console","warn","FileDropper","initializeDataModel","initializeDOMHooks","stagedFileErrors","$element","$","$dropzone","$fileInput","isAdvancedUpload","div","on","fileList","target","files","handleNewFileList","click","stopPropagation","addClass","removeClass","originalEvent","dataTransfer","unwireListeners","off","length","stagedFile","validateStagedFile","val","handleClearClicked","saveFile","getByteSizes","bytes","kiloBytes","megaBytes","getFileSizeString","byteSizes"],"mappings":"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","file":"app-bundle.js","sourcesContent":["export class App {\r\n  constructor() {}\r\n\r\n  configureRouter(cfg, router) {\r\n    this.router = router;\r\n    cfg.title = 'Word.ly';\r\n\r\n    cfg.map([\r\n      {\r\n        route: '',\r\n        name: 'main',\r\n        moduleId: 'containers/main-page/main-page'\r\n      }\r\n    ]);\r\n  }\r\n}\r\n","export default {\r\n  debug: true,\r\n  testing: true,\r\n  gatewayRootURL: 'http://localhost:8080'\r\n};\r\n","import environment from './environment';\r\n\r\n//Configure Bluebird Promises.\r\nPromise.config({\r\n  warnings: {\r\n    wForgottenReturn: false\r\n  }\r\n});\r\n\r\nexport function configure(aurelia) {\r\n  aurelia.use\r\n    .standardConfiguration()\r\n    .feature('resources');\r\n\r\n  if (environment.debug) {\r\n    aurelia.use.developmentLogging();\r\n  }\r\n\r\n  if (environment.testing) {\r\n    aurelia.use.plugin('aurelia-testing');\r\n  }\r\n\r\n  aurelia.start().then(() => aurelia.setRoot());\r\n}\r\n","/* ADAPTED FROM https://github.com/Authman2/AUAudioRecorder */\r\n\r\nexport default class AudioRecorder {\r\n  permission = false;\r\n  mediaRecorder;\r\n  outputType = 'audio/mp3; codecs=opus'; // Default is mp3\r\n  audio; // This 'audio' serves as the final recording by the user.\r\n  blob; // The blob that can be used for file operations.\r\n  mediaStream;\r\n  shouldLoop = false;\r\n  playing = false;\r\n\r\n  recordingStopSuccessCallback;\r\n  recordingStopErrorCallback;\r\n\r\n  constructor(recordingStopSuccessCallback, recordingStopErrorCallback) {\r\n    navigator.getUserMedia = (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia);\r\n    this.recordingStopSuccessCallback = recordingStopSuccessCallback;\r\n    this.recordingStopErrorCallback = recordingStopErrorCallback;\r\n  }\r\n  /* Asks the user for their this.permission to access the computer's microphone. */\r\n\r\n  requestPermission() {\r\n    if (navigator.getUserMedia) {\r\n      // Definitions\r\n      const constraints = { audio: true };\r\n      let chunks = [];\r\n\r\n      const onSuccess = (stream) => {\r\n        // Initialize the media recorder\r\n        this.mediaRecorder = new MediaRecorder(stream);\r\n        this.mediaStream = stream;\r\n\r\n        this.mediaRecorder.onstop = (e) => {\r\n          // Create some new elements in the html\r\n          const clipContainer = document.createElement('article');\r\n          clipContainer.classList.add('clip');\r\n          this.audio = document.createElement('audio');\r\n          this.audio.setAttribute('controls', '');\r\n          clipContainer.appendChild(this.audio);\r\n\r\n          // Set some properties\r\n          this.audio.controls = true;\r\n          const blob = new Blob(chunks, { 'type': this.outputType });\r\n          chunks = [];\r\n          const audioURL = window.URL.createObjectURL(blob);\r\n          this.audio.src = audioURL;\r\n          this.blob = blob;\r\n\r\n          if (typeof this.recordingStopSuccessCallback === 'function') {\r\n            this.recordingStopSuccessCallback(blob);\r\n          }\r\n        };// End of onstop action.\r\n\r\n        this.mediaRecorder.ondataavailable = (e) => {\r\n          chunks.push(e.data);\r\n        }; // End of ondataavailable action.\r\n      }; // End of onSuccess\r\n\r\n      const onError = (err) => {\r\n        if (typeof this.recordingStopErrorCallback === 'function') {\r\n          this.recordingStopErrorCallback(err);\r\n        }\r\n      };// End of onError\r\n\r\n      this.permission = true;\r\n      navigator.getUserMedia(constraints, onSuccess, onError);\r\n    } // End of if-supported-statement.\r\n  }\r\n\r\n  /* Starts the recording. */\r\n  startRecording() {\r\n    if (this.mediaRecorder !== null) {\r\n      this.mediaRecorder.start();\r\n    }\r\n  }\r\n\r\n  /* Stops the recording. */\r\n  stopRecording() {\r\n    if (this.mediaRecorder !== null) {\r\n      this.mediaRecorder.stop();\r\n    }\r\n  }\r\n\r\n  /* Plays the recording. */\r\n  play() {\r\n    if (this.audio !== null) {\r\n      this.audio.play();\r\n      this.playing = true;\r\n    }\r\n  }\r\n  /* Pauses the recording. */\r\n  pause() {\r\n    if (this.audio !== null) {\r\n      this.audio.pause();\r\n      this.playing = false;\r\n    }\r\n  }\r\n\r\n  /* Stops the recording from this.playing. Calling 'play' will start it from the beginning. */\r\n  stop() {\r\n    if (this.audio !== null) {\r\n      this.audio.pause();\r\n      this.audio.currentTime = 0;\r\n      this.playing = false;\r\n    }\r\n  }\r\n\r\n  /* Loops the recorded this.audio. */\r\n  loop(bool) {\r\n    if (this.audio !== null) {\r\n      (bool === true) ? this.audio.loop = true : this.audio.loop = false;\r\n    }\r\n  }\r\n\r\n  /* Goes to the beginning of the this.audio. */\r\n  stepBackward() {\r\n    if (this.audio !== null) {\r\n      this.audio.currentTime = 0;\r\n    }\r\n  }\r\n\r\n  /* Goes to the end of the this.audio. */\r\n  stepForward() {\r\n    if (this.audio !== null) {\r\n      this.audio.currentTime = this.audio.duration;\r\n    }\r\n  }\r\n\r\n  /* Clears the current recording. */\r\n  clear() {\r\n    this.audio = null;\r\n    this.playing = false;\r\n  }\r\n\r\n  /* Sets the file type for the this.audio recording.\r\n  Ex.) mp3, wav, ogg, etc.... */\r\n  setOutputFileType(fileType) {\r\n    this.outputType = 'audio/' + fileType + '; codecs=opus';\r\n  }\r\n\r\n  /* Returns whether or not the program has the user's this.permission to use the microphone. */\r\n  hasPermission() {\r\n    if (this.permission === undefined) return false;\r\n    return (this.permission === true) ? true : false;\r\n  }\r\n\r\n  /* Returns whether or not the this.audio will loop. */\r\n  isLooping() {\r\n    if (this.audio !== null && (typeof (this.audio) !== null) && this.audio !== undefined) {\r\n      if (this.audio.loop === true) {\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /* Returns whether or not the this.audio is currently this.playing. */\r\n  isPlaying() {\r\n    if (this.audio !== null && (typeof (this.audio) !== null) && this.audio !== undefined) {\r\n      if ((this.audio.currentTime === this.audio.duration && this.audio.loop === false) || (this.audio.currentTime === 0) || (this.isFinished())) {\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /* Returns the this.audio object that contains the final recording. */\r\n  getRecording() {\r\n    if (this.audio !== null && (typeof (this.audio) !== null) && this.audio !== undefined) { return this.audio; }\r\n    return null;\r\n  }\r\n\r\n  /* Returns a Blob object, which can be used for file operations. */\r\n  getRecordingFile() {\r\n    return this.blob;\r\n  }\r\n\r\n  /* This returns the media stream from the web audio API. */\r\n  getStream() {\r\n    if (this.mediaStream !== null && (typeof (this.mediaStream) !== null) && this.mediaStream !== undefined) { return this.mediaStream; }\r\n    return null;\r\n  }\r\n\r\n  /* Returns the output file type. */\r\n  getOutputType() {\r\n    if (this.outputType !== null && (typeof (this.outputType) !== null) && this.outputType !== undefined) { return this.outputType; }\r\n    return null;\r\n  }\r\n\r\n  /* Returns whether or not the audio is finished playing. */\r\n  isFinished() {\r\n    if (this.audio !== null && (typeof (this.audio) !== null) && this.audio !== undefined) { return this.audio.ended; }\r\n    return null;\r\n  }\r\n}\r\n\r\n","export const normalizeWord = (word) => (\r\n  word ? word.trim().toLowerCase() : word\r\n);\r\n","export function configure(config) {\r\n  config.globalResources([\r\n    './elements/audio-recorder',\r\n    './elements/file-dropper',\r\n    './attributes/allowed-chars'\r\n  ]);\r\n}\r\n","import { inject } from 'aurelia-framework';\r\nimport { bindable } from 'aurelia-framework';\r\n\r\nimport { normalizeWord } from '../../lib/word-utils';\r\nimport { DataAPI } from '../../gateways/data/data-api';\r\n\r\nimport * as Toastr from 'toastr';\r\n\r\n@inject(Element, DataAPI)\r\nexport class MainPage {\r\n  @bindable query = '';\r\n  normalizedQuery = '';\r\n\r\n  constructor(element, api) {\r\n    this.element = element;\r\n    this.api = api;\r\n    this.handleSavePronunciation = this.handleSavePronunciation.bind(this);\r\n    this.handlePronunciationFileValidation = this.handlePronunciationFileValidation.bind(this);\r\n    this.handleSavePronunciationFile = this.handleSavePronunciationFile.bind(this);\r\n    this.handleSaveNewWord = this.handleSaveNewWord.bind(this);\r\n  }\r\n\r\n  activate() {\r\n    this.initDataModel();\r\n  }\r\n\r\n  attached() {\r\n    this.audioPlayer = new window.Audio();\r\n    this.initDOMHooks();\r\n    this.wireEventListeners();\r\n  }\r\n\r\n  initDataModel() {\r\n    this.uploadingForWordId = null;\r\n    this.recordingForWordId = null;\r\n    this.isUploadingRecording = false;\r\n\r\n    this.isCreatingWord = false;\r\n    this.isUploadingNewWord = false;\r\n    this.isRecordingNewWord = false;\r\n\r\n    this.pronunciationLoadMap = {};\r\n    this.pronunciationCache = {};\r\n    this.queryStoredInBackend = true;\r\n\r\n    this.isLoadingWords = false;\r\n    this.wordsLoadedPct = 0;\r\n  }\r\n\r\n  initDOMHooks() {\r\n    this.wordFinderInput = this.element.querySelector('#word-finder');\r\n    this.wordFinderErrorLabel = this.element.querySelector('#word-finder-error');\r\n  }\r\n\r\n  wireEventListeners() {\r\n    let lastMessageTimeout;\r\n    let lastClearTimeout;\r\n    this.wordFinderInput.addEventListener('disallowed-key', () => {\r\n      this.wordFinderErrorLabel.classList.remove('fadeOut');\r\n\r\n      if (lastMessageTimeout) {\r\n        clearTimeout(lastMessageTimeout);\r\n        if (lastClearTimeout) {\r\n          clearTimeout(lastClearTimeout);\r\n        }\r\n      }\r\n\r\n      this.wordFinderErrorLabel.classList.add('fadeIn');\r\n      this.wordFinderErrorLabel.innerText = 'Words can only contain alphabetical characters';\r\n\r\n      // message should be temporary\r\n      lastMessageTimeout = setTimeout(() => {\r\n        this.wordFinderErrorLabel.classList.remove('fadeIn');\r\n        this.wordFinderErrorLabel.classList.add('fadeOut');\r\n        // delay for fadeout\r\n        lastClearTimeout = setTimeout(() => {\r\n          this.wordFinderErrorLabel.innerText = '';\r\n        }, 500);\r\n      }, 1000);\r\n    });\r\n  }\r\n\r\n  queryChanged() {\r\n    this.queryWords();\r\n  }\r\n\r\n  queryWords() {\r\n    const normalizedQuery = this.normalizedQuery = normalizeWord(this.query);\r\n    this.queryResult = [];\r\n    this.queryStoredInBackend = true;\r\n    if (normalizedQuery) {\r\n      this.isLoadingWords = true;\r\n      this.loaded = 0;\r\n\r\n      const doneLoading = (words) => {\r\n        this.wordsLoadedPct = 100;\r\n        setTimeout(() => {\r\n          this.isLoadingWords = false;\r\n          this.queryStoredInBackend = typeof words.find(word => word.word === normalizedQuery) !== 'undefined';\r\n          this.queryResult = words;\r\n        }, 150);\r\n      };\r\n\r\n      this.api.getWordsRequest(normalizedQuery)\r\n        .withDownloadProgressCallback(({ loaded, total }) => this.wordsLoadedPct = parseInt(loaded * 100.0 / total, 10))\r\n        .send()\r\n        .then((response) => {\r\n          const words = response.content;\r\n          doneLoading(words);\r\n        })\r\n        .catch((err) => {\r\n          doneLoading();\r\n        });\r\n    }\r\n  }\r\n\r\n  playPronunciation(wordId) {\r\n    const downloadAudio = (lastModified) => {\r\n      const loadMap = this.pronunciationLoadMap[wordId] = {\r\n        isAudioLoading: true,\r\n        audioLoadedPct: 0\r\n      };\r\n      const doneLoading = (audioBlob) => {\r\n        loadMap.audioLoadedPct = 100;\r\n        setTimeout(() => {\r\n          loadMap.isAudioLoading = false;\r\n          if (audioBlob) {\r\n            this.playAudioBlob(audioBlob);\r\n          }\r\n        }, 150);\r\n      };\r\n\r\n      this.api.getPronunciationRequest(wordId)\r\n        .withResponseType('blob')\r\n        .withDownloadProgressCallback(({ loaded, total }) => loadMap.audioLoadedPct = parseInt(loaded * 100.0 / total, 10))\r\n        .send()\r\n        .then((response) => {\r\n          const audioBlob = response.content;\r\n          this.pronunciationCache[wordId] = { audioBlob, lastModified };\r\n          doneLoading(audioBlob);\r\n        })\r\n        .catch((err) => {\r\n          doneLoading();\r\n        });\r\n    };\r\n\r\n    // check cache\r\n    let lastModified;\r\n    const prevPronunciation = this.pronunciationCache[wordId];\r\n    let hasNotChanged = true;\r\n    this.api.getWordRequest(wordId)\r\n      .send()\r\n      .then((response) => {\r\n        const word = response.content;\r\n        lastModified = word.lastModified;\r\n        hasNotChanged = prevPronunciation && prevPronunciation.lastModified === lastModified;\r\n        if (hasNotChanged && prevPronunciation.audioBlob) {\r\n          this.playAudioBlob(prevPronunciation.audioBlob);\r\n          return;\r\n        }\r\n        downloadAudio(lastModified);\r\n      });\r\n  }\r\n\r\n  handleRecordPronunciationClick(wordId) {\r\n    this.uploadingForWordId = null;\r\n    if (this.recordingForWordId === wordId) {\r\n      this.recordingForWordId = null;\r\n      return;\r\n    }\r\n    this.recordingForWordId = wordId;\r\n  }\r\n\r\n  handleUploadPronunciationClick(wordId) {\r\n    this.recordingForWordId = null;\r\n    if (this.uploadingForWordId === wordId) {\r\n      this.uploadingForWordId = null;\r\n      return;\r\n    }\r\n    this.uploadingForWordId = wordId;\r\n  }\r\n\r\n  handleSavePronunciation(audioBlob) {\r\n    this.isUploadingRecording = true;\r\n    this.api.getWordPronunciationUpdateRequest(this.recordingForWordId, audioBlob)\r\n      .send()\r\n      .then(() => {\r\n        notifySuccess('Saved!');\r\n        this.isUploadingRecording = false;\r\n        this.recordingForWordId = null;\r\n      })\r\n      .catch((err) => {\r\n        notifyFailure('An unexpected error occurred');\r\n        this.isUploadingRecording = false;\r\n      });\r\n  }\r\n\r\n  handleSavePronunciationFile(file) {\r\n    this.isUploadingRecording = true;\r\n    this.api.getWordPronunciationUpdateRequest(this.uploadingForWordId, file)\r\n      .send()\r\n      .then(() => {\r\n        notifySuccess('Saved!');\r\n        this.isUploadingRecording = false;\r\n        this.uploadingForWordId = null;\r\n      })\r\n      .catch((err) => {\r\n        notifyFailure('An unexpected error occurred');\r\n        this.isUploadingRecording = false;\r\n      });\r\n  }\r\n\r\n  handleSaveNewWord(audioBlob) {\r\n    this.isUploadingRecording = true;\r\n    this.api.getWordCreationRequest(this.normalizedQuery, audioBlob)\r\n      .send()\r\n      .then(() => {\r\n        notifySuccess('Saved!');\r\n        this.isUploadingRecording = false;\r\n        this.setNotRegisteringWord();\r\n        this.queryWords();\r\n      })\r\n      .catch((err) => {\r\n        notifyFailure('An unexpected error occurred');\r\n        this.isUploadingRecording = false;\r\n      });\r\n  }\r\n\r\n  setRegisteringWord() {\r\n    this.isCreatingWord = true;\r\n    this.isUploadingNewWord = false;\r\n    this.isRecordingNewWord = false;\r\n  }\r\n\r\n  setNotRegisteringWord() {\r\n    this.isCreatingWord = false;\r\n    this.isUploadingNewWord = false;\r\n    this.isRecordingNewWord = false;\r\n  }\r\n\r\n  handleRegisterWordClick() {\r\n    this.setRegisteringWord();\r\n  }\r\n\r\n  handleRegisterWordCancelClick() {\r\n    this.setNotRegisteringWord();\r\n  }\r\n\r\n  handleNewWordRecordClick() {\r\n    this.isUploadingNewWord = false;\r\n    this.isRecordingNewWord = true;\r\n  }\r\n\r\n  handleNewWordUploadClick() {\r\n    this.isUploadingNewWord = true;\r\n    this.isRecordingNewWord = false;\r\n  }\r\n\r\n  handlePronunciationFileValidation(file) {\r\n    const errors = [];\r\n    if (file.type !== 'audio/mp3') {\r\n      errors.push('We only accept .mp3 files');\r\n    }\r\n\r\n    if (file.size >= 1000000) {\r\n      errors.push('The size of the file exceeds 1MB');\r\n    }\r\n\r\n    return errors;\r\n  }\r\n\r\n  playAudioBlob(audioBlob) {\r\n    this.audioPlayer.src = window.URL.createObjectURL(audioBlob);\r\n    this.audioPlayer.play();\r\n  }\r\n}\r\n\r\nconst notifySuccess = (message) => {\r\n  Toastr.info(message, '', { timeOut: 750 });\r\n};\r\n\r\nconst notifyFailure = (message) => {\r\n  Toastr.warning(message, '', { timeOut: 1000  });\r\n};\r\n","import { inject } from 'aurelia-framework';\r\nimport { HttpClient } from 'aurelia-http-client';\r\nimport environment from '../../environment';\r\n\r\n@inject(HttpClient)\r\nexport class DataAPI {\r\n  constructor(client) {\r\n    this.client = client.configure(cfg => cfg\r\n      .withBaseUrl(environment.gatewayRootURL)\r\n    );\r\n  }\r\n\r\n  getWordsRequest(prefix) {\r\n    return this.client\r\n      .createRequest(`/words?query=${prefix}`)\r\n      .asGet();\r\n  }\r\n\r\n  getPronunciationRequest(wordId) {\r\n    return this.client\r\n      .createRequest(`/words/${wordId}/pronunciation`)\r\n      .asGet();\r\n  }\r\n\r\n  getWordRequest(wordId) {\r\n    return this.client\r\n      .createRequest(`/words/${wordId}`)\r\n      .asGet();\r\n  }\r\n\r\n  getWordPronunciationUpdateRequest(wordId, audioBlob) {\r\n    const formData = new FormData();\r\n    formData.append('pronunciation', audioBlob);\r\n    return this.client\r\n      .createRequest(`/words/${wordId}/pronunciation`)\r\n      .asPut()\r\n      .withContent(formData);\r\n  }\r\n\r\n  getWordCreationRequest(word, audioBlob) {\r\n    const formData = new FormData();\r\n    formData.append('word', word);\r\n    formData.append('pronunciation', audioBlob);\r\n    return this.client\r\n      .createRequest('/words')\r\n      .asPut()\r\n      .withContent(formData);\r\n  }\r\n}\r\n","import { customAttribute, inject } from 'aurelia-framework';\r\n\r\n@customAttribute('allowed-keys')\r\n@inject(Element)\r\nexport class AllowedChars {\r\n  constructor(element) {\r\n    this.element = element;\r\n\r\n    this.enterPressed = e => {\r\n      const key = e.key;\r\n      if (!(this.value && this.value.includes(key))) {\r\n        e.preventDefault();\r\n        this.element.dispatchEvent(new Event('disallowed-key'));\r\n        return;\r\n      }\r\n    };\r\n  }\r\n\r\n  attached() {\r\n    this.element.addEventListener('keypress', this.enterPressed);\r\n  }\r\n\r\n  detached() {\r\n    this.element.removeEventListener('keypress', this.enterPressed);\r\n  }\r\n}\r\n\r\n","import { bindable } from 'aurelia-framework';\r\n\r\nimport CustomAudioRecorder from '../../lib/custom-audio-recorder';\r\n\r\nexport class AudioRecorder {\r\n  @bindable save;\r\n  @bindable isSaving = false;\r\n  @bindable durationSeconds = 10;\r\n\r\n  constructor() {\r\n    this.initDataModel();\r\n    this.onRecorderSuccess = this.onRecorderSuccess.bind(this);\r\n  }\r\n\r\n  initDataModel() {\r\n    this.isAttached = false;\r\n    this.isRecording = false;\r\n    this.isProcessingRecording = false;\r\n    this.audioBlob = null;\r\n  }\r\n\r\n  resetDataModel() {\r\n    this.initDataModel();\r\n  }\r\n\r\n  attached() {\r\n    const recorder = this.recorder = new CustomAudioRecorder(this.onRecorderSuccess);\r\n    this.isAttached = true;\r\n    if (!recorder.hasPermission()) {\r\n      recorder.requestPermission();\r\n    }\r\n  }\r\n\r\n  onRecorderSuccess(audioBlob) {\r\n    this.audioBlob = audioBlob;\r\n    this.isProcessingRecording = false;\r\n  }\r\n\r\n  get hasPermission() {\r\n    return this.recorder && this.recorder.hasPermission();\r\n  }\r\n\r\n  get hasAudioData() {\r\n    return this.audioBlob;\r\n  }\r\n\r\n  get isPlaying() {\r\n    return this.recorder.isPlaying();\r\n  }\r\n\r\n  startRecording() {\r\n    this.audioBlob = null;\r\n    this.isRecording = true;\r\n    this.timeLeft = parseInt(this.durationSeconds, 10);\r\n    const killTimeMillis = new Date().getTime() + this.timeLeft * 1000;\r\n    this.countdownInterval = setInterval(() => {\r\n      const currTimeMillis = new Date().getTime();\r\n      const currTimeLeft = parseInt(Math.round((killTimeMillis - currTimeMillis) / 1000.0, 0), 10);\r\n      this.timeLeft = currTimeLeft >= 0 ? currTimeLeft : 0;\r\n      if (currTimeMillis >= killTimeMillis) {\r\n        this.stopRecording();\r\n      }\r\n    }, 1000);\r\n    this.recorder.startRecording();\r\n  }\r\n\r\n  stopRecording() {\r\n    this.isRecording = false;\r\n    this.isProcessingRecording = true;\r\n    this.recorder.stopRecording();\r\n    if (this.countdownInterval) {\r\n      clearInterval(this.countdownInterval);\r\n    }\r\n  }\r\n\r\n  playRecording() {\r\n    this.recorder.play();\r\n  }\r\n\r\n  detached() {\r\n    this.resetDataModel();\r\n    if (this.countdownInterval) {\r\n      clearInterval(this.countdownInterval);\r\n    }\r\n  }\r\n\r\n  handleSaveClicked() {\r\n    if (typeof this.save === 'function') {\r\n      this.save(this.audioBlob);\r\n    } else {\r\n      console.warn('No save callback provided');\r\n    }\r\n  }\r\n}\r\n","import { inject, bindable } from 'aurelia-framework';\r\n\r\nimport 'jquery';\r\n\r\n// adapted from https://css-tricks.com/drag-and-drop-file-uploading/\r\n@inject(Element)\r\nexport class FileDropper {\r\n  @bindable isSaving = false;\r\n  @bindable saveFile;\r\n  @bindable validateStagedFile;\r\n  @bindable acceptedTypes = '';\r\n\r\n  stagedFile;\r\n\r\n  constructor(element) {\r\n    this.element = element;\r\n  }\r\n\r\n  attached() {\r\n    this.initializeDataModel();\r\n    this.initializeDOMHooks();\r\n    this.wireEventListeners();\r\n  }\r\n\r\n  initializeDataModel() {\r\n    this.stagedFileErrors = [];\r\n  }\r\n\r\n  initializeDOMHooks() {\r\n    this.$element = $(this.element);\r\n    this.$dropzone = this.$element.find('.dropzone');\r\n    this.$fileInput = this.$dropzone.find('input[type=\"file\"]');\r\n  }\r\n\r\n  wireEventListeners() {\r\n    const $fileInput = this.$fileInput;\r\n    const $dropzone = this.$dropzone;\r\n\r\n    const isAdvancedUpload = (() => {\r\n      const div = document.createElement('div');\r\n      return (('draggable' in div) || ('ondragstart' in div && 'ondrop' in div)) && 'FormData' in window && 'FileReader' in window;\r\n    })();\r\n\r\n    $fileInput.on('change', (e) => {\r\n      const fileList = e.target.files;\r\n      this.handleNewFileList(fileList);\r\n    });\r\n\r\n    $dropzone.on('click', (e) => {\r\n      $fileInput.click();\r\n    });\r\n\r\n    $fileInput.on('click', (e) => {\r\n      e.stopPropagation();\r\n    });\r\n\r\n    if (isAdvancedUpload) {\r\n      $dropzone.addClass('has-advanced-upload')\r\n        .on('drag dragstart dragend dragover dragenter dragleave drop', (e) => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        })\r\n        .on('dragover dragenter', () => {\r\n          $dropzone.addClass('is-dragover');\r\n        })\r\n        .on('dragleave dragend drop', () => {\r\n          $dropzone.removeClass('is-dragover');\r\n        })\r\n        .on('drop', (e) => {\r\n          const fileList = e.originalEvent.dataTransfer.files;\r\n          this.handleNewFileList(fileList);\r\n        });\r\n    }\r\n  }\r\n\r\n  unwireListeners() {\r\n    this.$dropzone.off();\r\n    this.$fileInput.off();\r\n  }\r\n\r\n  handleNewFileList(fileList) {\r\n    if (fileList.length) {\r\n      const stagedFile = this.stagedFile = fileList[0];\r\n      if (typeof this.validateStagedFile === 'function') {\r\n        this.stagedFileErrors = this.validateStagedFile(stagedFile);\r\n      } else {\r\n        this.stagedFileErrors = [];\r\n      }\r\n    } else {\r\n      this.stagedFile = null;\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.stagedFile = null;\r\n    this.$fileInput.val('');\r\n    this.stagedFileErrors = [];\r\n  }\r\n\r\n  handleClearClicked() {\r\n    this.clear();\r\n  }\r\n\r\n  handleSaveClicked() {\r\n    if (typeof this.saveFile === 'function') {\r\n      this.saveFile(this.stagedFile);\r\n    } else {\r\n      console.warn('No save callback provided');\r\n    }\r\n  }\r\n\r\n  get hasStagedFile() {\r\n    return this.stagedFile;\r\n  }\r\n\r\n  get isStagedFileValid() {\r\n    return this.stagedFile && !this.stagedFileErrors.length;\r\n  }\r\n\r\n  detached() {\r\n    this.clear();\r\n    this.unwireListeners();\r\n  }\r\n\r\n  getByteSizes(bytes) {\r\n    return {\r\n      kiloBytes: parseInt(Math.round(bytes / 1000.0, 0), 10),\r\n      megaBytes: parseInt(Math.round(bytes / 1000000.0, 0), 10),\r\n      bytes\r\n    };\r\n  }\r\n\r\n  getFileSizeString(file) {\r\n    const byteSizes = this.getByteSizes(file.size);\r\n    if (byteSizes.megaBytes) {\r\n      return `~${byteSizes.megaBytes} MB`;\r\n    } else if (byteSizes.kiloBytes) {\r\n      return `~${byteSizes.kiloBytes} KB`;\r\n    }\r\n    return `~${byteSizes.kiloBytes} bytes`;\r\n  }\r\n}\r\n",".progress {\r\n  margin-bottom: 0 !important;\r\n}\r\n\r\n.word-controls-group.not-loading {\r\n  margin-bottom: 6px;\r\n}\r\n\r\n.word-create-group {\r\n  margin-bottom: 6px;\r\n}\r\n\r\n.no-entry-label {\r\n  font-size: 14px;\r\n  display: inline-block;\r\n  margin-top: 5px;\r\n}\r\n\r\n.toast, .toast-message {\r\n  cursor: default !important;\r\n}\r\n\r\n#word-finder-error {\r\n  height: 6px;\r\n}\r\n",".dropzone {\r\n  font-size: 1.25rem;\r\n  background-color: #f1f0f0;\r\n  position: relative;\r\n  padding-top: 25px;\r\n  padding-bottom: 25px;\r\n  cursor: pointer;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.dropzone.has-advanced-upload {\r\n  outline: 2px dashed #92b0b3;\r\n  outline-offset: -10px;\r\n\r\n  -webkit-transition: outline-offset .15s ease-in-out, background-color .15s linear;\r\n  transition: outline-offset .15s ease-in-out, background-color .15s linear;\r\n}\r\n\r\n.dropzone.is-dragover {\r\n  outline-offset: -20px;\r\n  outline-color: #f1f0f0;\r\n  background-color: #fff;\r\n}\r\n\r\n.dropzone_dragdrop,\r\n.dropzone_icon {\r\n  display: none;\r\n}\r\n\r\n.dropzone.has-advanced-upload .dropzone_dragdrop {\r\n  display: inline;\r\n}\r\n\r\n.dropzone.has-advanced-upload .dropzone_icon {\r\n  width: 100%;\r\n  height: 80px;\r\n  fill: #92b0b3;\r\n  display: block;\r\n  margin-bottom: 40px;\r\n}\r\n\r\n.dropzone_input_ctr {\r\n  width: 250px;\r\n  margin: 0 auto;\r\n}\r\n\r\n@-webkit-keyframes appear-from-inside {\r\n  from\t{ -webkit-transform: translateY( -50% ) scale( 0 ); }\r\n  75%\t\t{ -webkit-transform: translateY( -50% ) scale( 1.1 ); }\r\n  to\t\t{ -webkit-transform: translateY( -50% ) scale( 1 ); }\r\n}\r\n\r\n@keyframes appear-from-inside {\r\n  from\t{ transform: translateY( -50% ) scale( 0 ); }\r\n  75%\t\t{ transform: translateY( -50% ) scale( 1.1 ); }\r\n  to\t\t{ transform: translateY( -50% ) scale( 1 ); }\r\n}\r\n\r\n.staged-file-display {\r\n  margin-top: 15px;\r\n}\r\n\r\n.btn-file {\r\n    position: relative;\r\n    overflow: hidden;\r\n}\r\n\r\n.btn-file input[type=file] {\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n    min-width: 100%;\r\n    min-height: 100%;\r\n    font-size: 100px;\r\n    text-align: right;\r\n    filter: alpha(opacity=0);\r\n    opacity: 0;\r\n    outline: none;\r\n    background: white;\r\n    cursor: inherit;\r\n    display: block;\r\n}"],"sourceRoot":"../src"}